{
  "Task_id": 110,
  "Github_ID": "2536618",
  "Github_Project_Name": "thinkphp",
  "Programming_Language": "PHP",
  "suffix": ".php",
  "Interface_class": "IPC",
  "Interface_name": "HTTP client using fsockopen in PHP",
  "Instruction": "Task Description: Implement a PHP class that provides HTTP client functionality using fsockopen for making HTTP requests when cURL is not available. The class should support both GET and POST requests with configurable options like timeout, cookies, and blocking mode.\n\nClass Description: The Http class provides a static method for making HTTP requests using fsockopen. It's designed as a fallback when cURL isn't available, offering stable performance with configurable options for different HTTP request scenarios.\n\nMethods:\n\nMethod1: fsockopenDownload(string $url, array $conf = array()) -> mixed - Makes an HTTP request using fsockopen\n  Input:\n    - $url: string - The target URL to request\n    - $conf: array - Configuration options including:\n      - limit: int - Number of characters to read in segments (0 for unlimited)\n      - post: string|array - POST content (either as string or array for form data)\n      - cookie: string - Cookie content to send with request\n      - ip: string - IP address to use instead of resolving hostname\n      - timeout: int - Connection timeout in seconds (default: 15)\n      - block: bool - Whether to use blocking mode (default: true)\n  Output:\n    - Returns string containing the HTTP response body, or empty string on failure",
  "Canonical_solution": "namespace Org\\Net;\n\nclass Http\n{\n    /**\n     * \u4f7f\u7528 fsockopen \u901a\u8fc7 HTTP \u534f\u8bae\u76f4\u63a5\u8bbf\u95ee(\u91c7\u96c6)\u8fdc\u7a0b\u6587\u4ef6\n     * \u5982\u679c\u4e3b\u673a\u6216\u670d\u52a1\u5668\u6ca1\u6709\u5f00\u542f CURL \u6269\u5c55\u53ef\u8003\u8651\u4f7f\u7528\n     * fsockopen \u6bd4 CURL \u7a0d\u6162,\u4f46\u6027\u80fd\u7a33\u5b9a\n     * @static\n     * @access public\n     * @param string $url \u8fdc\u7a0bURL\n     * @param array $conf \u5176\u4ed6\u914d\u7f6e\u4fe1\u606f\n     *        int   limit \u5206\u6bb5\u8bfb\u53d6\u5b57\u7b26\u4e2a\u6570\n     *        string post  post\u7684\u5185\u5bb9,\u5b57\u7b26\u4e32\u6216\u6570\u7ec4,key=value&\u5f62\u5f0f\n     *        string cookie \u643a\u5e26cookie\u8bbf\u95ee,\u8be5\u53c2\u6570\u662fcookie\u5185\u5bb9\n     *        string ip    \u5982\u679c\u8be5\u53c2\u6570\u4f20\u5165,$url\u5c06\u4e0d\u88ab\u4f7f\u7528,ip\u8bbf\u95ee\u4f18\u5148\n     *        int    timeout \u91c7\u96c6\u8d85\u65f6\u65f6\u95f4\n     *        bool   block \u662f\u5426\u963b\u585e\u8bbf\u95ee,\u9ed8\u8ba4\u4e3atrue\n     * @return mixed\n     */\n    public static function fsockopenDownload($url, $conf = array())\n    {\n        $return = '';\n        if (!is_array($conf)) {\n            return $return;\n        }\n\n        $matches                                       = parse_url($url);\n        !isset($matches['host']) && $matches['host']   = '';\n        !isset($matches['path']) && $matches['path']   = '';\n        !isset($matches['query']) && $matches['query'] = '';\n        !isset($matches['port']) && $matches['port']   = '';\n        $host                                          = $matches['host'];\n        $path                                          = $matches['path'] ? $matches['path'] . ($matches['query'] ? '?' . $matches['query'] : '') : '/';\n        $port                                          = !empty($matches['port']) ? $matches['port'] : 80;\n\n        $conf_arr = array(\n            'limit'   => 0,\n            'post'    => '',\n            'cookie'  => '',\n            'ip'      => '',\n            'timeout' => 15,\n            'block'   => true,\n        );\n\n        foreach (array_merge($conf_arr, $conf) as $k => $v) {\n            ${$k} = $v;\n        }\n\n        if ($post) {\n            if (is_array($post)) {\n                $post = http_build_query($post);\n            }\n            $out = \"POST $path HTTP/1.0\\r\\n\";\n            $out .= \"Accept: */*\\r\\n\";\n            $out .= \"Accept-Language: zh-cn\\r\\n\";\n            $out .= \"Content-Type: application/x-www-form-urlencoded\\r\\n\";\n            $out .= \"User-Agent: $_SERVER[HTTP_USER_AGENT]\\r\\n\";\n            $out .= \"Host: $host\\r\\n\";\n            $out .= 'Content-Length: ' . strlen($post) . \"\\r\\n\";\n            $out .= \"Connection: Close\\r\\n\";\n            $out .= \"Cache-Control: no-cache\\r\\n\";\n            $out .= \"Cookie: $cookie\\r\\n\\r\\n\";\n            $out .= $post;\n        } else {\n            $out = \"GET $path HTTP/1.0\\r\\n\";\n            $out .= \"Accept: */*\\r\\n\";\n            $out .= \"Accept-Language: zh-cn\\r\\n\";\n            $out .= \"User-Agent: $_SERVER[HTTP_USER_AGENT]\\r\\n\";\n            $out .= \"Host: $host\\r\\n\";\n            $out .= \"Connection: Close\\r\\n\";\n            $out .= \"Cookie: $cookie\\r\\n\\r\\n\";\n        }\n        $fp = @fsockopen(($ip ? $ip : $host), $port, $errno, $errstr, $timeout);\n        if (!$fp) {\n            return '';\n        } else {\n            stream_set_blocking($fp, $block);\n            stream_set_timeout($fp, $timeout);\n            @fwrite($fp, $out);\n            $status = stream_get_meta_data($fp);\n            if (!$status['timed_out']) {\n                while (!feof($fp)) {\n                    if (($header = @fgets($fp)) && (\"\\r\\n\" == $header || \"\\n\" == $header)) {\n                        break;\n                    }\n                }\n\n                $stop = false;\n                while (!feof($fp) && !$stop) {\n                    $data = fread($fp, (0 == $limit || $limit > 8192 ? 8192 : $limit));\n                    $return .= $data;\n                    if ($limit) {\n                        $limit -= strlen($data);\n                        $stop = $limit <= 0;\n                    }\n                }\n            }\n            @fclose($fp);\n            return $return;\n        }\n    }\n}",
  "FSMID_for_test": 131,
  "Code_level": "Class-level"
}