{
  "Task_id": 412,
  "Github_ID": "155206197",
  "Github_Project_Name": "TrackRay",
  "Programming_Language": "Java",
  "suffix": ".java",
  "Interface_class": "IPC",
  "Interface_name": "TCP Client-side Java.io",
  "Instruction": "Task Description: Create a Java class that checks for a specific vulnerability (HTTP.sys Remote Code Execution) in a target server using TCP client communication.\n\nClass Description: The HttpSysRCEClient class is designed to detect the presence of the CVE-2015-1635 (MS15-034) vulnerability in a target HTTP server by sending specially crafted HTTP requests and analyzing the responses. It utilizes TCP socket communication to interact with the server.\n\nAttributes:\n- target: String - The URL of the target server to be checked\n- task: Task - An object containing task-related information and results\n\nMethods:\n- HttpSysRCEClient(String target, Task task) -> None - Constructor that initializes the target URL and task object\n- checkVulnerability() -> void - Main method that performs the vulnerability check by:\n  1. Establishing TCP connection to the target server\n  2. Sending crafted HTTP requests with malicious Range headers\n  3. Analyzing responses for vulnerability indicators\n  4. Adding vulnerability to task results if detected\n- addVulnerable() -> void - Helper method that adds vulnerability information to the task results when detected",
  "Canonical_solution": "import com.trackray.base.bean.Task;\nimport com.trackray.base.bean.Vulnerable;\nimport com.trackray.base.utils.IOUtils;\nimport com.trackray.base.utils.SysLog;\nimport org.apache.commons.lang3.StringUtils;\n\nimport java.io.InputStream;\nimport java.io.OutputStream;\nimport java.net.Socket;\nimport java.net.URL;\nimport java.util.Arrays;\nimport java.util.concurrent.Callable;\nimport java.util.concurrent.FutureTask;\nimport java.util.concurrent.TimeUnit;\n\npublic class HttpSysRCEClient {\n\n    private String target;\n    private Task task;\n\n    public HttpSysRCEClient(String target, Task task) {\n        this.target = target;\n        this.task = task;\n    }\n\n    public void checkVulnerability() {\n        try {\n            URL url = new URL(target);\n            String host = url.getHost();\n            int port = url.getPort();\n\n            Socket socket = new Socket(host, port);\n\n            Callable<String> callable = new Callable<String>() {\n                @Override\n                public String call() throws Exception {\n                    String hexAllFfff = \"18446744073709551615\";\n                    String req = \"GET / HTTP/1.0\\r\\nHost: \" + host + \"\\r\\nRange: bytes=0-\" + hexAllFfff + \"\\r\\n\\r\\n\";\n\n                    InputStream inputStream = socket.getInputStream();\n                    OutputStream outputStream = socket.getOutputStream();\n\n                    outputStream.write(req.getBytes());\n                    outputStream.flush();\n\n                    return IOUtils.analysisStream(inputStream);\n                }\n            };\n\n            FutureTask<String> futureTask = new FutureTask<>(callable);\n            futureTask.run();\n            \n            try {\n                String result = futureTask.get(30, TimeUnit.SECONDS);\n                if (StringUtils.contains(result, \"Requested Range Not Satisfiable\")) {\n                    addVulnerable();\n                }\n            } catch (Exception e) {\n                Socket newSocket = new Socket(host, port);\n\n                callable = new Callable<String>() {\n                    @Override\n                    public String call() throws Exception {\n                        String hexAllFfff = \"18446744073709551615\";\n                        String req = \"GET / HTTP/1.1\\r\\nHost: \" + host + \"\\r\\nRange: bytes=0-\" + hexAllFfff + \"\\r\\n\\r\\n\";\n\n                        InputStream inputStream = newSocket.getInputStream();\n                        OutputStream outputStream = newSocket.getOutputStream();\n\n                        outputStream.write(req.getBytes());\n                        outputStream.flush();\n\n                        return IOUtils.analysisStream(inputStream);\n                    }\n                };\n\n                futureTask.cancel(true);\n                futureTask = new FutureTask<>(callable);\n                futureTask.run();\n                \n                try {\n                    String result = futureTask.get(30, TimeUnit.SECONDS);\n                    if (StringUtils.contains(result, \"Requested Range Not Satisfiable\")) {\n                        addVulnerable();\n                    }\n                } catch (Exception ee) {\n                } finally {\n                    futureTask.cancel(true);\n                    newSocket.close();\n                }\n            } finally {\n                socket.close();\n            }\n        } catch (Exception e) {\n            SysLog.error(e);\n        }\n    }\n\n    private void addVulnerable() {\n        task.getResult().addVulnerable(\n            Vulnerable.builder()\n                .title(\"HTTP.sys \u8fdc\u7a0b\u4ee3\u7801\u6267\u884c\")\n                .address(target)\n                .level(Vulnerable.Level.HIGH.getLevel())\n                .type(Vulnerable.Type.CODE_EXECUTION.getType())\n                .vulnId(Arrays.asList(\"CVE-2015-1635\", \"MS15-034\"))\n                .build()\n        );\n    }\n}",
  "FSMID_for_test": 15,
  "Code_level": "Class-level"
}