{
  "Task_id": 224,
  "Github_ID": "70612113",
  "Github_Project_Name": "Home-AssistantConfig",
  "Programming_Language": "JavaScript",
  "suffix": ".js",
  "Interface_class": "IPC",
  "Interface_name": "WebSocket Client-side based on browser native API in JavaScript",
  "Instruction": "Task Description: Implement a WebSocket client class in JavaScript that manages WebSocket connections with reconnection capabilities and event handling.\n\nClass Description: The N class represents a WebSocket client that connects to a specified URL, handles messages, errors, and connection events, and supports automatic reconnection. It provides methods to start, destroy, and manage the WebSocket connection, along with callbacks for connection events.\n\nAttributes:\n- url: [String] - The WebSocket server URL to connect to.\n- options: [Object] - Configuration options for the WebSocket connection, including protocols, reconnect interval, and callbacks.\n- socket: [WebSocket] - The WebSocket connection instance.\n- streaming: [Boolean] - Indicates if the connection is in streaming mode.\n- callbacks: [Object] - Contains arrays of callback functions for connection and data events.\n- destination: [Object] - The destination to write received data to.\n- reconnectInterval: [Number] - The interval (in seconds) between reconnection attempts.\n- shouldAttemptReconnect: [Boolean] - Indicates if reconnection should be attempted.\n- completed: [Boolean] - Indicates if the connection is completed.\n- established: [Boolean] - Indicates if the connection is established.\n- progress: [Number] - Tracks the connection progress.\n- reconnectTimeoutId: [Number] - The timeout ID for reconnection attempts.\n- onEstablishedCallback: [Function] - Callback function triggered when the connection is established.\n- onCompletedCallback: [Function] - Callback function triggered when the connection is completed.\n- hookOnEstablished: [Function] - Optional hook function triggered when the connection is established.\n\nMethods:\n- constructor(url, options) -> [N] - Initializes the WebSocket client with the given URL and options.\n- connect(destination) -> [void] - Sets the destination for received data.\n- destroy() -> [void] - Closes the WebSocket connection and stops reconnection attempts.\n- start() -> [void] - Starts the WebSocket connection and sets up event handlers.\n- resume() -> [void] - Placeholder for resuming the connection (currently empty).\n- onOpen() -> [void] - Handles the WebSocket 'open' event and updates progress.\n- onClose() -> [void] - Handles the WebSocket 'close' and 'error' events and initiates reconnection if enabled.\n- onMessage(event) -> [void] - Handles the WebSocket 'message' event, writes data to the destination, and triggers callbacks.",
  "Canonical_solution": "class N {\n  constructor(A, t) {\n    this.url = A;\n    this.options = t;\n    this.socket = null;\n    this.streaming = !0;\n    this.callbacks = { connect: [], data: [] };\n    this.destination = null;\n    this.reconnectInterval = void 0 !== t.reconnectInterval ? t.reconnectInterval : 5;\n    this.shouldAttemptReconnect = !!this.reconnectInterval;\n    this.completed = !1;\n    this.established = !1;\n    this.progress = 0;\n    this.reconnectTimeoutId = 0;\n    this.onEstablishedCallback = t.onSourceEstablished;\n    this.onCompletedCallback = t.onSourceCompleted;\n    t.hookOnEstablished && (this.hookOnEstablished = t.hookOnEstablished);\n  }\n\n  connect(A) {\n    this.destination = A;\n  }\n\n  destroy() {\n    clearTimeout(this.reconnectTimeoutId);\n    this.shouldAttemptReconnect = !1;\n    this.socket.close();\n  }\n\n  start() {\n    this.shouldAttemptReconnect = !!this.reconnectInterval;\n    this.progress = 0;\n    this.established = !1;\n    this.options.protocols\n      ? (this.socket = new WebSocket(this.url, this.options.protocols))\n      : (this.socket = new WebSocket(this.url));\n    this.socket.binaryType = \"arraybuffer\";\n    this.socket.onmessage = this.onMessage.bind(this);\n    this.socket.onopen = this.onOpen.bind(this);\n    this.socket.onerror = this.onClose.bind(this);\n    this.socket.onclose = this.onClose.bind(this);\n  }\n\n  resume() {}\n\n  onOpen() {\n    this.progress = 1;\n  }\n\n  onClose() {\n    var A = this;\n    this.shouldAttemptReconnect &&\n      (clearTimeout(this.reconnectTimeoutId),\n      (this.reconnectTimeoutId = setTimeout(function () {\n        A.start();\n      }, 1e3 * this.reconnectInterval)));\n  }\n\n  onMessage(A) {\n    var t = !this.established;\n    this.established = !0;\n    t && this.hookOnEstablished && this.hookOnEstablished();\n    t && this.onEstablishedCallback && this.onEstablishedCallback(this);\n    this.destination && this.destination.write(A.data);\n  }\n}",
  "FSMID_for_test": 89,
  "Code_level": "Class-level"
}